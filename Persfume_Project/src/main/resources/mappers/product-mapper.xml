<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="productMapper">
	
	<!-- EVENT 테이블의 조회 결과를 자바 Event VO 타입으로 뽑아주는 resultMap -->
	<resultMap type="product" id="productResultSet">
		<result column="PRODUCT_NO" property="productNo" />
		<result column="PRODUCT_NAME" property="productName" />
		<result column="PRODUCT_EXPLAIN" property="productExplain" />
		<result column="PRODUCT_PRICE" property="productPrice" />
		<result column="PRODUCT_STOCK" property="productStock" />
		<result column="REGIST_DATE" property="registDate" />
		<result column="CATEGORY" property="category" />
		<result column="GENDER" property="gender" />
		<result column="TOP_NOTE" property="topNote" />
		<result column="MIDDLE_NOTE" property="middleNote" />
		<result column="BASE_NOTE" property="baseNote" />
		<result column="PRODUCT_STATUS" property="productStatus" />
		<result column="DISCOUNT" property="discount" />
	</resultMap>
	
	<resultMap type="productImg" id="productImgResultSet">
		<result column="IMG_NO" property="productImgNo" />
		<result column="IMG_NAME" property="productImgPath" />
		<result column="IMG_TYPE" property="imgType" />
		<result column="PRODUCT_NO" property="productNo" />
	</resultMap>
	
	<resultMap type="MemCoupon" id="MemCouponResultSet">
		<result column="REGIST_DATE" property="registDate" />
		<result column="STATUS" property="status" />
		<result column="MEM_NO" property="memNo" />
		<result column="COUPON_NO" property="couponNo" />
	</resultMap>
	
	<resultMap type="Coupon" id="CouponResultSet">
		<result column="COUPON_NO" property="coupon_no" />
		<result column="COUPON_NAME" property="coupon_name" />
	</resultMap>
	<!--  주문테이블  -->
		<resultMap id="OrderDetailResultSet"
		type="OrderDetail">
		<result column="ORDER_NO" property="orderNo" />
		<result column="PAY_CODE" property="payCode" />
		<result column="TOTAL_PRICE" property="totalPrice" />
		<result column="ORDER_WANT" property="orderWant" />
		<result column="DELIVERY_STATUS" property="deliveryStatus" />
		<result column="ORDER_DATE" property="orderDate" />
		<result column="REFUND_DATE" property="refundDate" />
		<result column="MEM_NO" property="memNo" />
	</resultMap>
	<!--  장바구니 테이블  -->
	<resultMap type="Cart" id="CartResultSet">
		<result column="CART_NO" property="cartNo" />
		<result column="PRICE" property="price" />
		<result column="QUANTITY" property="quantity" />
		<result column="MEM_NO" property="memNo" />
		<result column="PRODUCT_NO" property="productNo" />
	</resultMap>
	
	
	<!--  상품조회 카운트 숫자 구하는 쿼리문 -->
	<select id="selectListCount"
			resultType="_int">
		SELECT COUNT(*)
		  FROM PRODUCT
		 WHERE PRODUCT_STATUS = 'Y'
	</select>
	
	<!-- 상품조회 기본목록을 구하는 쿼리문(등록일순) -->
	<select id="selectList"
			resultMap="productResultSet">
		SELECT * 
		  FROM PRODUCT
		 WHERE PRODUCT_STATUS = 'Y' 
		 ORDER BY PRODUCT_NO DESC
	</select>
		<!-- 상품조회 이미지 구하는 쿼리문 -->
	<select id="selectImgList"
			resultMap="productImgResultSet">
		SELECT * 
		  FROM PRODUCT_IMG 
		 WHERE IMG_TYPE = '1' 
		 ORDER BY PRODUCT_NO DESC
	</select>
			<!-- 상품상세조회 상품 정보 구하는 쿼리문 -->
	<select id="selectProduct"
		parameterType="_int"
			resultMap="productResultSet">
		SELECT * 
		  FROM PRODUCT 
		 WHERE PRODUCT_NO = #{pno}
	</select>
		<!-- 상품상세조회  상품 이미지 구하는 쿼리문 -->
	<select id="selectProductImgList"
		parameterType="_int"
			resultMap="productImgResultSet">
		SELECT * 
		  FROM PRODUCT_IMG 
		 WHERE PRODUCT_NO = #{pno} 
		  AND IMG_TYPE = '2' 
	</select>
	<!--  상품상세조회 상품 이미지 구하는 쿼리문(썸네일) -->
		<select id="selectProductImg"
		parameterType="_int"
		resultMap="productImgResultSet">
		SELECT * 
		  FROM PRODUCT_IMG 
		 WHERE PRODUCT_NO = #{pno} 
		  AND IMG_TYPE = '1' 
	</select>
	<!--  회원번호를 통해 발급 받은 쿠폰 긁어가기 -->
 	 <select id="searchCoupon"
		parameterType="_int"
		resultMap="MemCouponResultSet">
		SELECT * 
		FROM MEM_COUPON 
		WHERE MEM_NO = #{mno} 
		AND STATUS = 'Y' 
		AND ADD_MONTHS(REGIST_DATE, 1) > SYSDATE
		</select>
			<!--  쿠폰  이름 긁어가기 -->
 	 <select id="searchCouponName"
 	 	parameterType="_int"
		resultMap="CouponResultSet">
		SELECT * 
		FROM COUPON 
		WHERE COUPON_NO = #{cno} 
		</select>
		<!--  주문 완료시 테이블에 정보넣자  -->
 	  		<insert id="orderComplete"
			parameterType="OrderDetail">
		INSERT INTO ORDER_DETAIL(ORDER_NO
		                , PAY_CODE
		                , TOTAL_PRICE
		                , ORDER_WANT
		                , DELIVERY_STATUS
		                , ORDER_DATE
		                , REFUND_DATE
		                , MEM_NO) 
		           VALUES(SEQ_ORDER_NO.NEXTVAL
		                , #{payCode}
		                , #{totalPrice}
		                , #{orderWant}
		                , 'N'
		                , SYSDATE
		                , SYSDATE+3
		                , #{memNo}) 
	</insert>
	<!-- 주문완료 후 고객에게 보여주기 -->
 	 	 <select id="orderview"
 	 	parameterType="String"
 	 	resultMap="OrderDetailResultSet">
		SELECT * 
		FROM ORDER_DETAIL 
		WHERE PAY_CODE = #{merchant_uid}  
		</select>
 	 	<!--  카트에 물건 넣기  -->
 	  		<insert id="cartAdd"
			parameterType="Cart">
		INSERT INTO CART(CART_NO
		                , PRICE
		                , QUANTITY
		                , MEM_NO
		                , PRODUCT_NO)
		           VALUES(SEQ_CART_NO.NEXTVAL
		                , #{price}
		                , #{quantity}
		                , #{memNo}
		                , #{productNo})  
	</insert>
			<!-- 장바구니 페이지에 보여줄 장바구니 리스트 -->
	<select id="selectCartList"
		parameterType="_int"
			resultMap="CartResultSet">
		SELECT * 
		  FROM CART 
		 WHERE MEM_NO = #{mno} 
	</select>
	<!-- 카트에 담긴 선택 상품 삭제 -->
		<delete id="cartdelete" parameterType="_int">
		DELETE  
		FROM CART 
		WHERE CART_NO = #{cno} 
		</delete>
		<!--  카트 번호로 해당 상품 번호 긁어오기용 쿼리문 -->
 	 <select id="cartSelect"
 	 	parameterType="_int"
		resultMap="CartResultSet">
		SELECT * 
		 FROM CART 
		WHERE CART_NO = #{cno}
		</select>
	<!-- 장바구니 수량 업데이트  -->
		<update id="cartUpdate"
			parameterType="Cart">
		UPDATE CART
		   SET PRICE = #{price}
		     , QUANTITY = #{quantity}
		 WHERE CART_NO = #{cartNo} 
	</update>
	
</mapper>
